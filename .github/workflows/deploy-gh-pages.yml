name: Deploy Blazor WebAssembly to GitHub Pages

on:
 push:
 branches:
 - master
 - main

permissions:
 contents: read
 pages: write
 id-token: write

jobs:
 build-and-deploy:
 runs-on: ubuntu-latest

 steps:
 - name: Checkout repository
 uses: actions/checkout@v4
 with:
 fetch-depth:0

 - name: Setup .NET
 uses: actions/setup-dotnet@v4
 with:
 dotnet-version: '8.0.x'

 - name: Restore and publish Blazor WebAssembly
 run: |
 dotnet restore
 dotnet publish PrimePro/PrimePro.csproj -c Release -o ./publish

 - name: Show publish output (diagnostics)
 run: |
 echo "Listing publish folder"
 ls -la ./publish || true
 echo "Listing publish/wwwroot"
 ls -la ./publish/wwwroot || true

 - name: Fix base href for GitHub Pages and create SPA fallback
 run: |
 REPO_NAME=${GITHUB_REPOSITORY#*/}
 if [ -f ./publish/wwwroot/index.html ]; then
 sed -i "s|<base href=\"/\" />|<base href=\"/${REPO_NAME}/\" />|" ./publish/wwwroot/index.html || true
 cp ./publish/wwwroot/index.html ./publish/wwwroot/404.html
 else
 echo "index.html not found in publish/wwwroot"
 ls -la ./publish || true
 fi

 - name: Upload Pages artifact
 uses: actions/upload-pages-artifact@v1
 with:
 path: ./publish/wwwroot

 - name: Deploy to GitHub Pages
 uses: actions/deploy-pages@v1
