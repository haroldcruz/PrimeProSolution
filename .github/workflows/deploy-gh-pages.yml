name: Deploy Blazor WebAssembly to GitHub Pages (official actions)

on:
 push:
 branches: [ master ]

permissions:
 contents: read
 pages: write
 id-token: write

jobs:
 build-and-deploy:
 runs-on: ubuntu-latest

 steps:
 - name: Checkout repository
 uses: actions/checkout@v4
 with:
 fetch-depth:0

 - name: Setup .NET
 uses: actions/setup-dotnet@v4
 with:
 dotnet-version: '8.0.x'

 - name: Restore and publish Blazor WebAssembly
 run: |
 dotnet restore
 dotnet publish PrimePro/PrimePro.csproj -c Release -o ./publish

 - name: Fix base href for GitHub Pages and create SPA fallback
 run: |
 REPO_NAME=${GITHUB_REPOSITORY#*/}
 if [ -f ./publish/wwwroot/index.html ]; then
 # Set base href to repository name for project pages
 sed -i "s|<base href=\"/\" />|<base href=\"/${REPO_NAME}/\" />|" ./publish/wwwroot/index.html || true
 # Create404 fallback for SPA routing
 cp ./publish/wwwroot/index.html ./publish/wwwroot/404.html
 fi

 - name: Upload Pages artifact
 uses: actions/upload-pages-artifact@v1
 with:
 path: ./publish/wwwroot

 - name: Deploy to GitHub Pages
 uses: actions/deploy-pages@v1
